# Библиотека для получения погоды от OpenWeatherMap на платформах ESP8266/ESP32 и Arduino IDE

### [English](README.md) | Русский

#### OWM_for_ESP - простая и оптимизированная библиотека для работы с сервисом OpenWeatherMap. Она умеет взаимодействовать с несколькими видами API: [Current](https://openweathermap.org/current) (только текущая погода) и [One Call](https://openweathermap.org/api/one-call-api) (погода с прогнозом).

Для использования необходима библиотека для парсинга JSON: https://github.com/Bodmer/JSON_Decoder.

Использование библиотеки
=====
* `.getWeather(*current, *hourly, *daily, latitude, longitude, type)` принимает структуры типа **OWM_current**, **OWM_hourly** и **OWM_daily**, широту и долготу пользователя и тип API, с помощью которого формируется запрос. Он добавляет все полученные данные в структуры, из которых впоследствии можно легко взять необходимые данные.
* `.getCurrentWeather(*current, latitude, longitude)` аналогичен `.getWeather(*current, nullptr, nullptr, latitude, longitude, CURRENT)`.
* `.getFullWeather(*current, *hourly, *daily, latitude, longitude)` аналогичен `.getWeathergetFullWeather(*current, *hourly, *daily, latitude, longitude, FULL)`.

* `.setApiKey(apiKey)` сохраняет ваш ключ для дальнейшего получения погоды.
* `.setUnits(units)` сохраняет предпочтительный тип units.

* `.getIconCode(iconId, begin, end)` позволяет получить код иконки из её внутреннего библиотечного ID. Этот метод был добавлен для сохранения оперативной памяти.
* `.getShortStatus(id)` позволяет получить упрощённое описание погоды из её официального ID. Этот метод был добавлен для сохранения оперативной памяти и лёгкого редактирования состояний, если официальные Вас не устроят.
* `.getShortStatus(id)` позволяет получить полное описание погоды из её официального ID. Этот метод был добавлен для сохранения оперативной памяти и лёгкого редактирования состояний, если официальные Вас не устроят.
* `.getShortStatus16(id)` аналогичен методу `.getShortStatus(id)`, но выдаёт сокращённые до 16 символов состояния специально для дисплеев.

Узнайте больше о работе с библиотекой с помощью тестового примера `OWM_for_ESP_Test`. Также Вы можете изменить параметры логирования, тип подключения (*незащищенный* HTTP или *защищённый* HTTPS), включить строковые переменные, количество минут и часов (для One Call) или изменить язык перевода для вывода надписей о состоянии погоды в файле `User_Setup.h`, находящемся в папке с библиотекой.

ESP8266 и ESP32 не имеют хардверной криптографии, поэтому защищённое подключение через HTTPS занимает в 2.5-3.5 раза больше времени. Если Вас не беспокоит защита, вы можете включить незащищённый режим подключения. И не забудьте, что официальная документация [рекомендует](https://arduino-esp8266.readthedocs.io/en/latest/esp8266wifi/bearssl-client-secure-class.html#cpu-requirements) использовать скорость процессора 160 MHZ для ESP8266 при защищённом подключении (установлено по умолчанию).
***
Вы можете посмотреть список проектов, использующих OWM_for_ESP, в [readme на английском](README.md). Если вы опубликовали новый проект, использующий OWM_for_ESP - напишите ссылку в **Issues** с пометкой `new project`, добавьте немного описания на английском и я добавлю его в список.